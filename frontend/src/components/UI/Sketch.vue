<template>
  <div class="sketch">
    <div
      :class="['sketch__header', {
        active: isOpen
      }]"
    >
      <div class="sketch__header-row">
        <div class="sketch__logo">
            <svg width="119" height="15" viewBox="0 0 119 15" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5.08807 14.2045C4.26989 14.2045 3.54759 13.9979 2.92116 13.5845C2.29474 13.1669 1.80469 12.5788 1.45099 11.8203C1.0973 11.0575 0.920455 10.1562 0.920455 9.11648C0.920455 8.08523 1.0973 7.19034 1.45099 6.43182C1.80469 5.6733 2.29688 5.08736 2.92756 4.67401C3.55824 4.26065 4.28693 4.05398 5.11364 4.05398C5.75284 4.05398 6.25781 4.16051 6.62855 4.37358C7.00355 4.58239 7.28906 4.82102 7.48509 5.08949C7.68537 5.35369 7.84091 5.57102 7.9517 5.74148H8.07955V0.909091H9.58807V14H8.13068V12.4915H7.9517C7.84091 12.6705 7.68324 12.8963 7.47869 13.169C7.27415 13.4375 6.98224 13.6783 6.60298 13.8913C6.22372 14.1001 5.71875 14.2045 5.08807 14.2045ZM5.29261 12.8494C5.89773 12.8494 6.40909 12.6918 6.8267 12.3764C7.24432 12.0568 7.56179 11.6158 7.77912 11.0533C7.99645 10.4865 8.10511 9.83239 8.10511 9.09091C8.10511 8.35795 7.99858 7.71662 7.78551 7.1669C7.57244 6.61293 7.2571 6.18253 6.83949 5.87571C6.42188 5.56463 5.90625 5.40909 5.29261 5.40909C4.65341 5.40909 4.12074 5.57315 3.6946 5.90128C3.27273 6.22514 2.95526 6.66619 2.74219 7.22443C2.53338 7.77841 2.42898 8.40057 2.42898 9.09091C2.42898 9.78977 2.53551 10.4247 2.74858 10.9957C2.96591 11.5625 3.28551 12.0142 3.70739 12.3509C4.13352 12.6832 4.66193 12.8494 5.29261 12.8494ZM16.009 14.2045C15.1226 14.2045 14.3449 13.9936 13.6759 13.5717C13.0111 13.1499 12.4913 12.5597 12.1163 11.8011C11.7455 11.0426 11.5601 10.1562 11.5601 9.14205C11.5601 8.11932 11.7455 7.22656 12.1163 6.46378C12.4913 5.70099 13.0111 5.10866 13.6759 4.68679C14.3449 4.26491 15.1226 4.05398 16.009 4.05398C16.8954 4.05398 17.6709 4.26491 18.3357 4.68679C19.0047 5.10866 19.5246 5.70099 19.8954 6.46378C20.2704 7.22656 20.4579 8.11932 20.4579 9.14205C20.4579 10.1562 20.2704 11.0426 19.8954 11.8011C19.5246 12.5597 19.0047 13.1499 18.3357 13.5717C17.6709 13.9936 16.8954 14.2045 16.009 14.2045ZM16.009 12.8494C16.6823 12.8494 17.2363 12.6768 17.6709 12.3317C18.1056 11.9865 18.4273 11.5327 18.6361 10.9702C18.8449 10.4077 18.9493 9.7983 18.9493 9.14205C18.9493 8.4858 18.8449 7.87429 18.6361 7.30753C18.4273 6.74077 18.1056 6.28267 17.6709 5.93324C17.2363 5.58381 16.6823 5.40909 16.009 5.40909C15.3357 5.40909 14.7817 5.58381 14.3471 5.93324C13.9124 6.28267 13.5907 6.74077 13.3819 7.30753C13.1731 7.87429 13.0687 8.4858 13.0687 9.14205C13.0687 9.7983 13.1731 10.4077 13.3819 10.9702C13.5907 11.5327 13.9124 11.9865 14.3471 12.3317C14.7817 12.6768 15.3357 12.8494 16.009 12.8494Z" fill="black"/>
              <path d="M22.6624 3.47869V0.909091H33.7271V3.47869H29.7576V14H26.6383V3.47869H22.6624ZM35.2723 14V0.909091H40.68C41.6601 0.909091 42.506 1.08594 43.2176 1.43963C43.9336 1.78906 44.4854 2.2919 44.8732 2.94815C45.261 3.60014 45.4549 4.37358 45.4549 5.26847C45.4549 6.17614 45.2567 6.94744 44.8604 7.58239C44.4641 8.21307 43.9016 8.6946 43.1729 9.02699C42.4442 9.35511 41.5813 9.51918 40.5841 9.51918H37.1644V7.02628H39.9961C40.4733 7.02628 40.8718 6.96449 41.1914 6.84091C41.5152 6.71307 41.7603 6.52131 41.9264 6.26562C42.0926 6.00568 42.1757 5.6733 42.1757 5.26847C42.1757 4.86364 42.0926 4.52912 41.9264 4.26491C41.7603 3.99645 41.5152 3.79616 41.1914 3.66406C40.8675 3.5277 40.4691 3.45952 39.9961 3.45952H38.4364V14H35.2723ZM42.6424 8.01705L45.9023 14H42.4506L39.2546 8.01705H42.6424ZM50.022 14H46.6214L51.0383 0.909091H55.2507L59.6676 14H56.267L53.1924 4.20739H53.0902L50.022 14ZM49.5681 8.84801H56.6761V11.2514H49.5681V8.84801ZM72.2184 0.909091V14H69.5337L64.3242 6.4446H64.2411V14H61.077V0.909091H63.8L68.952 8.4517H69.0607V0.909091H72.2184ZM81.2839 4.83381C81.2413 4.36506 81.0516 4.00071 80.715 3.74077C80.3826 3.47656 79.9075 3.34446 79.2896 3.34446C78.8805 3.34446 78.5396 3.39773 78.2668 3.50426C77.9941 3.6108 77.7896 3.75781 77.6532 3.94531C77.5168 4.12855 77.4465 4.33949 77.4423 4.57812C77.4337 4.77415 77.4721 4.94673 77.5573 5.09588C77.6468 5.24503 77.7746 5.37713 77.9408 5.49219C78.1113 5.60298 78.3158 5.70099 78.5545 5.78622C78.7931 5.87145 79.0616 5.94602 79.3599 6.00994L80.4849 6.26562C81.1326 6.40625 81.7036 6.59375 82.1979 6.82812C82.6965 7.0625 83.1141 7.34162 83.4508 7.66548C83.7917 7.98935 84.0495 8.36222 84.2242 8.78409C84.3989 9.20597 84.4884 9.67898 84.4927 10.2031C84.4884 11.0298 84.2796 11.7393 83.8663 12.3317C83.4529 12.924 82.8584 13.3778 82.0829 13.6932C81.3116 14.0085 80.3805 14.1662 79.2896 14.1662C78.1944 14.1662 77.2398 14.0021 76.4259 13.674C75.612 13.3459 74.9792 12.8473 74.5275 12.1783C74.0758 11.5092 73.8435 10.6634 73.8307 9.64062H76.8606C76.8861 10.0625 76.9991 10.4141 77.1994 10.6953C77.3996 10.9766 77.6745 11.1896 78.0239 11.3345C78.3776 11.4794 78.7867 11.5518 79.2512 11.5518C79.6773 11.5518 80.0396 11.4943 80.3378 11.3793C80.6404 11.2642 80.8726 11.1044 81.0346 10.8999C81.1965 10.6953 81.2796 10.4609 81.2839 10.1967C81.2796 9.94957 81.2029 9.73864 81.0538 9.56392C80.9046 9.38494 80.6745 9.23153 80.3634 9.10369C80.0566 8.97159 79.6646 8.85014 79.1873 8.73935L77.8194 8.41974C76.6859 8.1598 75.7931 7.74006 75.1411 7.16051C74.4891 6.5767 74.1653 5.78835 74.1695 4.79545C74.1653 3.9858 74.3826 3.27628 74.8215 2.6669C75.2604 2.05753 75.8677 1.58239 76.6432 1.24148C77.4188 0.900568 78.303 0.730113 79.2959 0.730113C80.3101 0.730113 81.1901 0.902698 81.9359 1.24787C82.6859 1.58878 83.2675 2.06818 83.6809 2.68608C84.0942 3.30398 84.3052 4.01989 84.3137 4.83381H81.2839ZM86.0907 14V0.909091H95.0268V3.47869H89.2548V6.16335H94.4579V8.73935H89.2548V14H86.0907ZM96.62 14V0.909091H105.748V3.47869H99.784V6.16335H105.281V8.73935H99.784V11.4304H105.748V14H96.62ZM107.729 14V0.909091H113.137C114.117 0.909091 114.963 1.08594 115.675 1.43963C116.391 1.78906 116.942 2.2919 117.33 2.94815C117.718 3.60014 117.912 4.37358 117.912 5.26847C117.912 6.17614 117.714 6.94744 117.317 7.58239C116.921 8.21307 116.359 8.6946 115.63 9.02699C114.901 9.35511 114.038 9.51918 113.041 9.51918H109.621V7.02628H112.453C112.93 7.02628 113.329 6.96449 113.648 6.84091C113.972 6.71307 114.217 6.52131 114.383 6.26562C114.55 6.00568 114.633 5.6733 114.633 5.26847C114.633 4.86364 114.55 4.52912 114.383 4.26491C114.217 3.99645 113.972 3.79616 113.648 3.66406C113.325 3.5277 112.926 3.45952 112.453 3.45952H110.893V14H107.729ZM115.099 8.01705L118.359 14H114.908L111.712 8.01705H115.099Z" fill="#846BCB"/>
            </svg>
        </div>
        <div
          class="header__right desktop"
        >
          <div class="header__right-wrap">
            <div class="identity box" v-if="connection.userIdentity">
              <p
                class="identity__wallet"
                 v-text="userIdentityShort"
              >
              </p>
              <div class="identity__logout" @click="logout">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.5 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5H7.5" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M13.3333 14.1667L17.4999 10L13.3333 5.83334" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M17.5 10H7.5" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>
          </div>
        </div>
        <div
          :class="['header__right mobile', {
            active: isOpen
          }]"
        >
          <div class="header__right-wrap">
            <div class="identity box" v-if="connection.userIdentity">
              <p
                class="identity__wallet"
                 v-text="userIdentityShort"
                 @click="isOpen = !isOpen"
              >
              </p>
            </div>
          </div>
        </div>
        <div class="header__mobile-menu" v-if="isOpen">
          <div class="header__mobile-menu__bg" @click="isOpen = false"></div>
          <div class="header__mobile-menu-inner">
            <div class="header__mobile-menu__item">
              <div class="identity__logout">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_81_719)">
                    <path d="M16.6667 7.5H9.16667C8.24619 7.5 7.5 8.24619 7.5 9.16667V16.6667C7.5 17.5871 8.24619 18.3333 9.16667 18.3333H16.6667C17.5871 18.3333 18.3333 17.5871 18.3333 16.6667V9.16667C18.3333 8.24619 17.5871 7.5 16.6667 7.5Z" stroke="#846BCB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4.16675 12.5H3.33341C2.89139 12.5 2.46746 12.3244 2.1549 12.0118C1.84234 11.6993 1.66675 11.2754 1.66675 10.8333V3.33332C1.66675 2.8913 1.84234 2.46737 2.1549 2.15481C2.46746 1.84225 2.89139 1.66666 3.33341 1.66666H10.8334C11.2754 1.66666 11.6994 1.84225 12.0119 2.15481C12.3245 2.46737 12.5001 2.8913 12.5001 3.33332V4.16666" stroke="#846BCB" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </g>
                  <defs>
                  <clipPath id="clip0_81_719">
                    <rect width="20" height="20" fill="white"/>
                  </clipPath>
                  </defs>
                </svg>
              </div>
              <span>Copy address</span>
            </div>
            <div class="header__mobile-menu__item" @click="logout">
              <div class="identity__logout">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7.5 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5H7.5" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M13.3333 14.1667L17.4999 10L13.3333 5.83334" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M17.5 10H7.5" stroke="#6755A1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <span>Logout</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sketch__main" :class="$attrs.class">
      <slot></slot>
    </div>
    <div class="sketch__footer">
      © 2022 doNFT & Quantor, All Rights Reserved.
    </div>
  </div>
</template>

<script>
    export default {
        inheritAttrs: false
    }
</script>

<script setup>
    import {ref, onMounted, watch} from "vue";
    import {useStore} from "@/store/main";
    import {storeToRefs} from "pinia";
    import {ConnectionStore} from '@/crypto/helpers'
    import AppConnector from "@/crypto/AppConnector";
    const store = useStore()
    const {
        connection,
        userIdentityShort,
        getExplorerLink
    } = storeToRefs(store);
    const openContractManage = () => store.changeManageContractView(true)
    const logout = async () => {
        await ConnectionStore.logOut()
    }

    let userBalance = ref({})
    let isOpen = ref(false)

    watch(() => connection.value.userIdentity, (newValue) => {
        if (newValue) getUserBalance()

        if (!newValue) userBalance.value = {}
    })

    onMounted(() => {
      if (connection.value.userIdentity) getUserBalance()
    })

    const getUserBalance = async () => {
        try{
          const balance = await AppConnector.connector.fetchBalanceAmount()
          console.log(balance, 'getUserBalance')
          userBalance.value = balance
        }
        catch (e) {
            console.log(e);
        }
    }
</script>